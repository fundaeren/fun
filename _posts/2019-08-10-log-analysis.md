# Log Analysis

ვაგრძელებთ კიბერ ოლიმპიადის(cybercube) ამოცანების განხილვას, თუ წინა 2 სტატია არ გინახავს, შეგიძლია მათ გაეცნო:

ვაგრძელებთ კიბერ ოლიმპიადის(**cybercube**) ამოცანების განხილვას, თუ წინა 2 სტატია არ გინახავს, შეგიძლია მათ გაეცნო:

> **Pcap Analysis** — [https://bit.ly/2M9L7f0](https://bit.ly/2M9L7f0)

> **რა არის Buffer Overflow ?**\- [https://bit.ly/2GZbNLr](https://bit.ly/2GZbNLr)

დღეს განვიხილავ ერთ-ერთი კატეგორიის, ლოგ ფაილების ანალიზის, რამდენიმე ამოცანას და ვეცდები, თითოეული ნაბიჯი დეტალურად ავხსნა.

კიბერ ოლიმპიადაზე გამოყენებული სავარჯიშოები შეგიძლიათ [**cyber-lab**](https://cyber-lab.tech/geo/challenges) — ზე იხილოთ.

მოდი ჩვენი პირველი ამოცანა იყოს **userpro**, რომლის პირობაც შემდეგია:

![](img/1__lMduzKu2__HxWSTBslAaK1w.png)

მოცემული გვაქვს **Apache**\-ის **Log** ფაილი, მოდი მისი ანალიზისთვის არ გამოვიყენოთ უკვე არსებულები ხელსაწყოები და ჩვენით დავწეროთ პატარა სკრიპტი.

მაშ ასე, მოვიმარჯვოთ ჩვენი საყვარელი ედიტორები და გავხსნათ **Log** ფაილი.

ჩვენი **Log** ფაილი შემდეგნაირად გამოიყურება:

![**Vim is love.**](img/1__HH7kgNu8b9RNFf0gEyNGdA.png)
**Vim is love.**

ალბათ პირველივე შეხედვაზე მიხვდებოდი, რომ ჩვენი **Log** ფაილი **Wordpress** ის საიტისაა.

მოდი სანამ **Log** ფაილში ძრომიალს გავაგრძელებთ, გავეცნოთ კითხვებს, რომლებზეც პასუხის გაცემა მოგვიწევს:

> **1\. რომელი IP მისამართებიდან განხორციელდა შეტევა?**

> **2\. რა ხელსაწყო გამოიყენა შემტევმა ვებ გვერდის სკანირებისთვის?**

> **3\. რომელი პლაგინის საშუალებით მოახერხა შემტევმა წვდომის მოპოვება?**

> **4\. რა ტიპის შეტევა გამოიყენა შემტევმა წვდომის მოსაპოვებლად?**

> **5\. რომელ ოპერაციულ სისტემას იყენებდა შემტევი?**

პირველ კითხვის პასუხის გაგება მოდი დავიწყოთ **IP** ების სტატისტიკის გაგებით, ვნახოთ თუ რამდენი რექვესთი გაგზავნა თითოეულმა **IP**\-მა.

ამისთვის პირველ რიგში უნდა წავიკითხოთ ფაილი, მაგრამ სანამ ფაილის წაკითხვაზე გადავალთ ვნახოთ, როგორ გამოიუყურება ჩვენი რექვესთი.

![](img/1__qZ__Wv7L4SDDEFWvpTdv1lQ.png)

> **185.220.101.32** _-->_ **_IP_** _მისამართი._

> **_\[_12/Apr/2018:08:10:42 +0000\]** _--> თარიღი, დრო სასაათოო სარტყელი._

> **"GET / HTTP/1.1"** _\-->_ **_HTTP_** _რექვესთის ტიპი._

> **_200_** _--> სერვერის დაბრუნებული რესფონს კოდი._

> **19246** _--> გადაცემული ბაიტების რაოდენობა._

> **Mozilla/5.0 (Windows NT 6.1; rv:52.0) Gecko/20100101 Firefox/52.0** _--> აქ გვაქვს იმ მომხარებლის ინფორმაცია, რომელმაც რექვესთი გააგზავნა_

მაგრამ ჯერ-ჯერობით მხოლოდ **IP** გვაინტერესებს, როგორც უკვე აღვნიშნეთ ჩვენი პირველი ნაბიჯი

*   **Log ფაილის წაკითხვაა.**

![](img/1__KjUomgLqFxi0jQ3NKNHL__A.png)

მოდი ახლა მეორე ნაწილზე გადავიდეთ,

*   **IP მისამართების სტატისტიკა**

![[**https://gist.github.com/ls4cfk/addf7cfeba6eb7dc582ff7692c19a380#file-py**](https://gist.github.com/ls4cfk/addf7cfeba6eb7dc582ff7692c19a380#file-py)](img/1__q6pdBX7__H7z02RcAvSu9Iw.png)
[**https://gist.github.com/ls4cfk/addf7cfeba6eb7dc582ff7692c19a380#file-py**](https://gist.github.com/ls4cfk/addf7cfeba6eb7dc582ff7692c19a380#file-py)

*   მთლიანი რექვესთი არ გვჭირდბება, ამიტომაც რაღაცის საშუალებით უნდა გაგვეგო მხოლოდ **IP** მისამართები, რაშიც ძალიან დაგვეხმარა **Regex**\-ი.
*   დავაიმპორტეთ რეჯექსის მოდული და დავწერეთ პატერნი, რომელიც მხოლოდ **IPv4** მისამართებს ეძებს.

**r’\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}’**

**\\d** ნამდვილი რიცხვისთვის **\[0–9\]**.

**{1, 3}** — წერტილიდან წერტილამდე 1 იდან 3 ის ჩათვლით სიგრძის რიცხვის მოსაძებნად.  
**iplist = re.findall(ipv4, log)**

თუ დაემთხვა მნიშვნელობა ჩვენ პატერნს, ვინახავთ **iplist** ცვლადში, და **Counter()** ისა და **most\_common()** ფუნქციების საშუალებით, ვითვლით და გამოგვაქვს სასურველ ფორმატში.

**ipcount = Counter(iplist)  
for k, v in ipcount.most\_common():  
   print(f”IP => {str(k)} რაოდენობა => {str(v)}”)**

შედეგიც მივიღეთ:

![](img/1__IhWS0CaGiyRhl29ZdPgaIA.png)

კარგი გვაქვს **IP** ები, ყველა ხშირად გამოყენებულიც ვიცით რომელია, მაგრამ როგორ გავიგოთ მართლა შემტევისაა თუ არა ეს **IP**?

მოდი ვნახოთ პირველი **IP**, ვნახოთ თუ სად ფიგურირებს ის.

> **cat case1.log | grep 164.132.106.162**

> თუ ვინდოუსზე ხართ, სასურველი ტექსტ ედიტორი გახსენით და **Ctrl +f** :)

![](img/1__Ry4atfWIbfP4fnkzbDppJQ.png)

რექვესთი ჩვენს მიერ განხილულს გავს, მაგრამ ბოლოში ახალი საინტერესო რამ გამოჩნდა. **WPScan**\-ი, ის სკანერია რომლის დანიშნულებაც **WordPress** ის საიტებში მოწყვლადობის პოვნაა.

ამ რექვესთის საშუალებით, მეორე კითხვის პასუხიც გავიგეთ — შემტევს ხელსაწყო **WPScan**\-ი გამოუყენებია.

მოდი **IP** ების დასადგენად, ჩვენი რექვესთები გავფილტროთ ‘**WPScan**’ ით, გამოვიტანოთ მხოლოდ ის **IP** ები, რომლებშიც აღნიშნული სკანერი ფიგურირებს.

ცოტა გადავაკეთოთ ჩვენი კოდი:

![[**https://gist.github.com/ls4cfk/addf7cfeba6eb7dc582ff7692c19a380#file-filtering-by-wpscan**](https://gist.github.com/ls4cfk/addf7cfeba6eb7dc582ff7692c19a380#file-filtering-by-wpscan)](img/1__6G8pps1Cos1PlJWdY__TlcA.png)
[**https://gist.github.com/ls4cfk/addf7cfeba6eb7dc582ff7692c19a380#file-filtering-by-wpscan**](https://gist.github.com/ls4cfk/addf7cfeba6eb7dc582ff7692c19a380#file-filtering-by-wpscan)

**IP** ებიც გავიგეთ, 164.132.106.162 და 122.116.50.42

![](img/1__txEMxF6qqCXasMKWcLZBEQ.png)

მოდი სანამ შემდეგ კითხვაზე გადავალთ, გავასუფთავოთ ჩვენი ლოგ ფაილი, დავტოვოთ მხოლოდ ის რექვესთები სადაც ჩვენი **IP-**ები ფიგურირებს.

მთლად დიდი შედეგი ვერ მივიღეთ, მაგრამ 300 ხაზით შევამოკლეთ ჩვენი ლოგ ფაილი.

![](img/1__4NR9JpeHETVNlTVflknoWA.png)

აშკარად ბევრი ისეთი რექვესთი გვაქვს, რომლებსაც 404 კოდი დაუბრუნდათ. ეგენიც არ გვჭირდება, მოდი კიდევ ერთხელ გავფილტროთ.

![](img/1__CXWAt3txd__r6XagcUk__36A.png)

Sweet!, 36 რექვესთზე დავედით. მოდი ჩავიხედოთ დარჩენილ რექვესთებში:

![](img/1__pDzNMeFJLbho6fetHaFfDg.png)

ამ რექვესთებიდან ვარკვევთ, რომ **WPScan** ის სკანირების დასრულების შემდეგ,დაახლოებით 1 წუთში, გაიგზავნა რექვესთი **?up\_auto\_log=true**, რომელმაც შემტევს მისცა საიტზე წვდომა.

[**exploit-db**](http://www.exploit-db.com) — ზე თუ გადავამოწმებთ აღმოვაჩენთ, რომ აღნიშნული რექვესთის საშუალებით ავტორიზაციის ავლის საშუალებას, პლაგინი **userpro** გვაძლევდა.

![](img/1__vQ5xvMdasXzLEYK8yb__d6A.png)

გავარკვიეთ მესამე და მეოთხე კითხვის პასუხიც:

**userpro** და **Authentication Bypass**

დაგვრჩა ბოლო კითხვა, რომლის პასუხიც ჩვენს მიერ გაფილტრურ ლოგებში კარგად ჩანს:

![](img/1__FypOOReztGFDesHkhhHWpA.png)

შემტევი იყენებდა Linux-ის ერთ-ერთ დისტრიბუტივს — Ubuntu-ს.

### მოდი შემდეგი ამოცანა Fisheye იყოს

რომლის პირობაც შემდეგია:

![](img/1__4H49krojWTaK9__ua4g83Wg.png)

**Fisheye** — ს შემთხვევაში მოცემული გვაქვს წერილი და შემდეგი **3** შეკითხვა:

> **1\. შეტევის რომელი ტიპი გამოიყენა შემტევმა?**

> **2\. რა სახის ინფორმაციის მოპარვას ცდილობს შემტევი?**

> **3\. დაასახელეთ შეტევაში გამოყენებული მისამართი**

კვლავ მოვიმარჯვოთ საყვარელი ედიტორები და გავხსნათ ჩვენი მეილი.

![](img/1__69F2oLA__Raj4LpNQ__jwJoQ.png)

ნუ, სტანდარტული მეილია. მოდი **Base64** იდან დეკოდირება გავუკეთოთ ჩვენი მეილის კონტენტს:

> **strings case\_email | base64 -D**

> სადაც **case\_email** მხოლოდ **base64** ს შეიცავს.

> **windows** -ის შემთხვევაში — [**base64decode.org**](https://www.base64decode.org/)

![](img/1__c7N3gf7__7d1IPSAI07fWKA.png)

თავში არასაჭირო ინფორმაცია, მოდი მოვაშოროთ და ვნახოთ ჩვენი მეილი.

![](img/1__Y0aZTrdtSNpyOnEZrxsw__A.png)

კიდევ ბევრი არასაჭირო ინფორმაცია, მოდი ისინიც მოვაშოროთ.

![](img/1__0zZlv9RqSsAd3uL1eDjdBw.png)

ვაშორებთ ყველა **HTML Tag**\-ს **href** ის გარდა, თუ რატომ ცოტახანში ვნახავთ.

მივიღეთ ჩვენი გასუფთავებული იმეილიც:

![](img/1__gPIFA7Xb2Lv9fxGZ34h05Q.png)

მეილიდან უკვე ყველაფერი გასაგები ხდება:

შემტევმა გაგზავნა მეილი სადაც **EMS.GOV.GE** ის მაგივრად, მსხვერპლი გადაიყვანა არასწორ ბმულზე [**http://ems.ga**](http://ems.ga) რომელიც ფიშინგ საიტია. ასეთი ტიპის ფიშინგ შეტევას **Spear phishing** ეწოდება.

ასევე ვარკვევთ, რომ შემტევი ცდილობს პირადი ინფორმაციის მოპარვას.

![](img/1__S7N5XoJzSPkXQpJK__BVVcg.png)

სულ ეს იყო, ამოვხსენით 2 სავარჯიშო და მივიღეთ თითოეულ კითხვაზე პასუხი.

კიბერ ოლიმპიადა ძალიან კარგი საშუალებაა ახალი ინფორმაციის შესასწავლად, [**cyber-lab**](https://cyber-lab.tech/) ზე შეგიძლიათ აკეთოთ სავარჯიშოები, რომლებიც გაგაცნობენ რეალურ ინციდენტებს, მსგავსი ტიპის ფიშინგ შეტევები უამრავია, ზარალდება ბევრი ადამიანი იმის გამო, რომ არ უკვირდებიან ლინკს სადაც ისინი გადადიან. ¯\\\_(ツ)\_/¯

By [Aleksi Kistauri](https://medium.com/@aleksikistauri) on [August 10, 2019](https://medium.com/p/a6404da4a4df).

[Canonical link](https://medium.com/@aleksikistauri/log-analysis-a6404da4a4df)

Exported from [Medium](https://medium.com) on January 6, 2020.